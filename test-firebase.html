<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Test Aislado: Firebase</title>
    <style>
        body {
            background: #222;
            color: #fff;
            font-family: monospace;
            padding: 2rem;
        }
    </style>
</head>

<body>
    <h1>Diagn√≥stico de Backend (Firebase)</h1>
    <div id="log">Iniciando pruebas...<br></div>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <!-- Config -->
    <script src="firebase-config.js"></script>

    <script>
        function log(msg, color = 'white') {
            const div = document.getElementById('log');
            div.innerHTML += `<span style="color: ${color}">> ${msg}</span><br>`;
        }

        window.onload = function () {
            log("1. Verificando SDKs...");
            if (typeof firebase !== 'undefined') log("‚úÖ Firebase SDK cargado", "lightgreen");
            else return log("‚ùå Firebase SDK NO cargado", "red");

            log("2. Verificando Configuraci√≥n...");
            if (typeof firebaseConfig !== 'undefined') log("‚úÖ Configuraci√≥n encontrada", "lightgreen");
            else return log("‚ùå Configuraci√≥n NO encontrada", "red");

            log("3. Intentando Conexi√≥n Auth...");
            if (firebase.auth()) {
                log("‚úÖ Auth Service listo", "lightgreen");
                firebase.auth().onAuthStateChanged(user => {
                    if (user) log(`üë§ Usuario logueado: ${user.email}`, "cyan");
                    else log("üë§ No hay usuario logueado (pero el servicio funciona)", "yellow");
                });
            } else {
                log("‚ùå Auth Service fall√≥", "red");
            }

            log("4. Intentando Conexi√≥n Firestore...");
            try {
                const db = firebase.firestore();
                log("‚úÖ Firestore Service instanciado", "lightgreen");

                // Try a simple read
                log("   Intentando leer colecci√≥n 'testimonies'...", "gray");
                db.collection('testimonies').limit(1).get()
                    .then(snap => {
                        log(`‚úÖ Lectura exitosa. Documentos encontrados: ${snap.size}`, "lightgreen");
                    })
                    .catch(err => {
                        log(`‚ö†Ô∏è Error de lectura (puede ser permisos): ${err.message}`, "orange");
                        if (err.code === 'permission-denied') log("   Nota: Esto es normal si no has configurado las reglas de seguridad a√∫n.", "gray");
                    });

            } catch (e) {
                log(`‚ùå Error cr√≠tico Firestore: ${e.message}`, "red");
            }
        };
    </script>
</body>

</html>